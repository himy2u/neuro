<div class="lang-dropdown-container">
    <button id="lang-menu-btn" aria-haspopup="true" aria-expanded="false" onclick="toggleLangMenu()">
        üåê <span id="current-lang-flag">üá∫üá∏</span> <span id="current-lang-text">English</span>
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round" style="margin-left:5px;">
            <path d="M6 9l6 6 6-6" />
        </svg>
    </button>

    <div id="lang-dropdown-menu" class="lang-menu" role="menu" style="display: none;">
        <button role="menuitem" onclick="setLanguage('en')">üá∫üá∏ English (EN)</button>
        <button role="menuitem" onclick="setLanguage('es')">üá™üá® Espa√±ol (ES)</button>
        <button role="menuitem" onclick="setLanguage('fr')">üá´üá∑ Fran√ßais (FR)</button>
        <button role="menuitem" onclick="setLanguage('de')">üá©üá™ Deutsch (DE)</button>
    </div>
</div>

<script>
    const langNames = {
        'en': 'English',
        'es': 'Espa√±ol',
        'fr': 'Fran√ßais',
        'de': 'Deutsch'
    };

    const langFlags = {
        'en': 'üá∫üá∏',
        'es': 'üá™üá®',
        'fr': 'üá´üá∑',
        'de': 'üá©üá™'
    };

    // Initialize Language
    const currentLang = localStorage.getItem('site_lang') || 'en';
    document.documentElement.setAttribute('lang', currentLang);
    document.body.classList.add('lang-' + currentLang);
    document.getElementById('current-lang-text').innerText = langNames[currentLang];
    document.getElementById('current-lang-flag').innerText = langFlags[currentLang];

    function toggleLangMenu() {
        const menu = document.getElementById('lang-dropdown-menu');
        const btn = document.getElementById('lang-menu-btn');
        const isExpanded = btn.getAttribute('aria-expanded') === 'true';

        if (isExpanded) {
            menu.style.display = 'none';
            btn.setAttribute('aria-expanded', 'false');
        } else {
            menu.style.display = 'block';
            btn.setAttribute('aria-expanded', 'true');
        }
    }

    function setLanguage(newLang) {
        // Remove all previous lang classes
        const classes = document.body.className.split(" ").filter(c => !c.startsWith('lang-'));
        document.body.className = classes.join(" ").trim();

        // Add new lang class
        document.body.classList.add('lang-' + newLang);
        document.documentElement.setAttribute('lang', newLang);
        localStorage.setItem('site_lang', newLang);

        // Update UI Button Text & Flag
        document.getElementById('current-lang-text').innerText = langNames[newLang];
        document.getElementById('current-lang-flag').innerText = langFlags[newLang];

        // Close menu
        toggleLangMenu();
    }

    // Close dropdown when clicking outside
    document.addEventListener('click', function (event) {
        const container = document.querySelector('.lang-dropdown-container');
        if (!container.contains(event.target)) {
            document.getElementById('lang-dropdown-menu').style.display = 'none';
            document.getElementById('lang-menu-btn').setAttribute('aria-expanded', 'false');
        }
    });
</script>

<style>
    .lang-dropdown-container {
        position: relative;
        margin-left: 20px;
        font-family: var(--font-primary);
    }

    #lang-menu-btn {
        background: transparent;
        border: 1px solid var(--color-border);
        border-radius: 8px;
        padding: 8px 16px;
        cursor: pointer;
        display: flex;
        align-items: center;
        color: var(--color-text);
        font-size: 0.9rem;
        font-weight: 500;
        transition: all var(--transition);
        white-space: nowrap;
    }

    #lang-menu-btn:hover {
        background: var(--color-surface);
        border-color: var(--color-primary);
    }

    .lang-menu {
        position: absolute;
        top: 100%;
        right: 0;
        margin-top: 8px;
        background: white;
        border: 1px solid var(--color-border);
        border-radius: 8px;
        box-shadow: var(--shadow-lg);
        min-width: 150px;
        z-index: 1000;
        overflow: hidden;
    }

    .lang-menu button {
        display: block;
        width: 100%;
        padding: 10px 16px;
        text-align: left;
        background: none;
        border: none;
        cursor: pointer;
        font-size: 0.9rem;
        color: var(--color-text);
        transition: background 0.2s;
    }

    .lang-menu button:hover {
        background: var(--color-surface);
        color: var(--color-primary);
        font-weight: 500;
    }

    /* Global Content Visibility Logic */
    div.lang-en,
    div.lang-es,
    div.lang-fr,
    div.lang-de,
    h1.lang-en,
    h1.lang-es,
    h1.lang-fr,
    h1.lang-de,
    h2.lang-en,
    h2.lang-es,
    h2.lang-fr,
    h2.lang-de,
    h3.lang-en,
    h3.lang-es,
    h3.lang-fr,
    h3.lang-de,
    p.lang-en,
    p.lang-es,
    p.lang-fr,
    p.lang-de {
        display: none;
    }

    body.lang-en .lang-en,
    body.lang-es .lang-es,
    body.lang-fr .lang-fr,
    body.lang-de .lang-de {
        display: block;
    }

    body.lang-en span.lang-en,
    body.lang-es span.lang-es,
    body.lang-fr span.lang-fr,
    body.lang-de span.lang-de {
        display: inline !important;
    }
</style>